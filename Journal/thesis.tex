%!LW recipe=latexmk (lualatex)
%Use lualatex to compile
%Therefore, do not use amssymb, input/output enc
% Get Error ".. \@ doesn't match definition.."? Try deleting all auxillary files.
\DocumentMetadata{
 lang=en,
 testphase={phase-III,math,table,title,firstaid},
 pdfversion=2.0,
 pdfstandard=ua-2,
 pdfstandard=a-4f,
 uncompress
}
% Template file for a standard thesis
\documentclass[11pt,notitlepage]{isuthesistagged}
% notitlepage is used because \begin{abstract} uses titlepage by default, which resets the page numbers

%Command below can toggle off tagging,
%speeding up compiling during drafting stages
%Comment out when ready to submit
%\tagpdfsetup{activate/all=false}


%Caption package & tagging fixes
\usepackage{caption}
%This work-around comes from: https://github.com/latex3/tagging-project/issues/720
\RemoveFromHook{begindocument}[latex-lab-testphase-float]
\makeatletter
\ExplSyntaxOn
\socket_new_plug:nnn{tagsupport/parbox/before}{caption}
  {   
   \tagpdfparaOn %restart para tagging
   \tl_if_empty:NTF\@current@float@struct
    {     
     \tag_struct_begin:n{tag=Caption,firstkid}
    }
    {
     \tag_struct_begin:n{tag=Caption,parent=\@current@float@struct,firstkid}
    } 
  }
\socket_new_plug:nnn{tagsupport/parbox/after}{caption}
  {
   \tag_struct_end:   
  }
\l@addto@macro\caption@beginex@hook{%
  \tagpdfparaOff %leavevmode in parbox should not start paragraph structure
  \AssignSocketPlug{tagsupport/parbox/before}{caption}
  \AssignSocketPlug{tagsupport/parbox/after}{caption}}
\ExplSyntaxOff
\AtBeginDocument{
	\renewcommand*\caption@anchor[1]{%
        \ifmeasuring@ \else
           \caption@raisedlink{\MakeLinkTarget*{#1}}%
        \fi}%  
}
\makeatother


%%Mathy packages
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{mathrsfs}
\usepackage{bm}
\usepackage{mathtools}
\usepackage{thmtools}
\usepackage{templatedShortcuts-private}
%%

\usepackage[default]{fontsetup}

\usepackage{unicode-math}

\usepackage{graphicx}
\chaptertitle
% Old-style, thesis numbering down to subsubsection
\alternate
\usepackage{rotating}
%Natbib compatibility mode activated
%Different styles available - look at biblatex documentation
\usepackage[natbib=true,style=authoryear,refsection=chapter,style=apa]{biblatex}
\addbibresource{thesisAccessTest.bib}
\setlength{\bibitemsep}{13.2pt}

%Set the author
\newcommand{\theAuthor}{Alice Wonder}
%Set the tite 
\twoLineTitle{This is the title of a thesis
submitted to Iowa State University on the first line}{
Note that only the first letter of
the first word and proper names
are capitalized and this is the second line}

%%PDF properties automatically set
\author{\theAuthor}
\title{\titleWithLineBreak}
\usepackage[hypertexnames=false,linktocpage=true,pdfauthor={\theAuthor},pdftitle={\titleWithoutBreak},]{hyperref}
\hypersetup{colorlinks=true,linkcolor=blue,citecolor=blue,filecolor=blue,urlcolor=blue,bookmarksnumbered=true,pdfview=FitB,pdfencoding=auto}


\overfullrule=0pt
%%%%%%%%%%%%%%%%%%%%%

\usepackage{etoolbox}
\makeatletter
\setlength{\@fptop}{0pt} %command added to ensure images always float on top of the page
\makeatother

\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{geometry}
\geometry{letterpaper, left=1in, top=1in, right=1in, bottom=1in, includehead=true,headheight=14pt} 
\usepackage{pdflscape}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[english]{nomencl}

\doublespacing
\AtBeginEnvironment{table}{\singlespacing}% 
\AtBeginEnvironment{figure}{\singlespacing}% 

%%%Captioning Format
\DeclareCaptionListFormat{figureList}{Figure #1#2}
\DeclareCaptionListFormat{tableList}{Table #1#2}
\captionsetup[figure]{listformat=figureList}
\captionsetup[table]{listformat=tableList}
\captionsetup[ContinuedFloat]{list=no}

%Gets rid of footnote rule(line)
%\renewcommand*\footnoterule{}

\begin{document}
\DeclareGraphicsExtensions{.jpg,.pdf,.mps,.png}
%command used in preface
\def\@makechapterheada{\vspace*{-2cm}\titlepage}
\include{Preface/titlepage}
\fancypagestyle{plain}{}

\raggedright
\parindent 0.25 in % set all paragraphs in the document to have indent

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %% The line below adds the word "Page" over the page numbers in TOC, LOT, LOF
\addtocontents{toc}{~\hfill\tagstructbegin{tag=H2,stash,label=pageOfTOC}\tagmcbegin{tag=H2}\textbf{Page}\par\tagmcend\tagstructend}
\addtocontents{lot}{~\hfill\tagstructbegin{tag=H2,stash,label=pageOfLOT}\tagmcbegin{tag=H2}\textbf{Page}\par\tagmcend\tagstructend}
\addtocontents{lof}{~\hfill\tagstructbegin{tag=H2,stash,label=pageOfLOF}\tagmcbegin{tag=H2}\textbf{Page}\par\tagmcend\tagstructend}
% %%


% %%
% % Optional thesis dedication
%   Dedication is not usually listed in the table of contents.
%   However, if you do want it, add this command here (not in the dedication file)
%   \addToBibWithoutChapter{DEDICATION}
\include{Preface/dedication}

{
\pdfbookmark[0]{TABLE OF CONTENTS}{table}
\tableofcontents
\tagstructuse{pageOfTOC} %gets tagging of "Page" done
}
\addtocontents{toc}{\def\protect\@chapapp{}} \cleardoublepage \phantomsection
\pagebreak
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\MakeLinkTarget[specialchapter]{}%necessary for tagging (as of 2024)
\addcontentsline{toc}{chapter}{LIST OF TABLES}
\listoftables
\tagstructuse{pageOfLOT}%gets tagging of "Page" done
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\cleardoublepage \phantomsection
\MakeLinkTarget[specialchapter]{} %necessary for tagging (as of 2024)
\addcontentsline{toc}{chapter}{LIST OF FIGURES}
\listoffigures
\tagstructuse{pageOfLOF}%gets tagging of "Page" done
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%Optional nomenclature
% \cleardoublepage \phantomsection
% \include{Preface/nomenclature}

%Adds Chapter in front of chapter on TOC
\addtocontents{toc}{\def\protect\@chapapp{CHAPTER\ }}

%Optional Acknowledgements
\cleardoublepage \phantomsection
\include{Preface/acknowl}
%Optional thesis abstract
\cleardoublepage \phantomsection
\include{Preface/abstract}
\newpage
\pagenumbering{arabic}
\pagestyle{fancy}
\include{Body/ch1/ch1_main}
\include{Body/ch2/ch2_main}
\include{Body/ch3/ch3_main}
\part{Let's have a part page}
\include{Body/ch4/ch4_main}
\include{Body/ch5/ch5_main}
\include{Body/mathSampler}
\include{Body/ch6/ch6_future_and_conclusions}
\clearpage
\pagebreak
\end{document}

